<html>
<head>
  <title>Evernote Export</title>
  <basefont face="Segoe UI" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308816 (es-ES, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: Segoe UI;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1394"/>

<div>
<span><div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: center;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%; text-decoration: underline;">ENTRENAR, CONVERTIR Y EJECUTAR MODELO MOBILENET</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Tutorial sacado de:</span> <a href="https://en.bbs.sipeed.com/t/topic/682/">https://en.bbs.sipeed.com/t/topic/682/</a></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Autor: Salvador Albarrán Tiradas</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Sistema operativo: Ubuntu 18.04</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Para Maix Go</span></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">TENSORFLOW Y KERAS</span></span></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><a href="https://www.tensorflow.org/" style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">https://www.tensorflow.org/</a></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><a href="https://keras.io/" style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">https://keras.io/</a></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"><span style="font-size: 12pt; font-weight: bold;"> </span></span></div><div style="text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">Tensorflow</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">es una plataforma de código abierto para el aprendizaje automático que cuenta con un ecosistema integral y flexible de herramientas, bibliotecas y recursos comunitarios para impulsar el estado del arte y desarrollar fácilmente aplicaciones basadas en aprendizaje automático.</span></div><div style="text-align: justify;"></div><div style="text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">Keras</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">es una API de redes neuronales de alto nivel, escrita en Python y capaz de ejecutarse sobre TensorFlow, CNTK o Theano.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">Admite redes convolucionales y redes recurrentes, así como combinaciones de las dos y se ejecuta sin problemas en CPU y GPU.</span></div><ol style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-size: 12pt;"><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;-en-paragraph:true;">Instalar el entorno (Se ha elegido Keras)</span></div></li></ol><div style="margin: 0mm 0mm 2.81mm 13mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm 13mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Nota: La versión de tensorflow 1.x a 2.x cambia la forma de escribir los scripts, por lo que si se usan los scripts que se dan en este ejemplo con la versión 2.x no funcionará, los cambios son básicamente que ya no hay que instalar Keras ya que está implementado dentro de tensorflow, por lo que para usar una librería de keras tendríamos que hacer:</span></div><div style="margin: 0mm 0mm 2.81mm 13mm; text-indent: 0mm; text-align: center;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Import tensorflow as tf</span></div><div style="margin: 0mm 0mm 2.81mm 13mm; text-indent: 0mm; text-align: center;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">tf.keras.optimizers…</span></div><div style="margin: 0mm 0mm 2.81mm 13mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">más información aquí:</span> <a href="https://www.tensorflow.org/guide/migrate/">https://www.tensorflow.org/guide/migrate/</a></div><div style="margin: 0mm 0mm 2.81mm 13mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm 12mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Tenemos varias opciones:</span></div><ol style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><ol style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 47pt; margin-right: 0pt; padding-left: 17pt; text-indent: 0pt; font-size: 12pt;"><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt;-en-paragraph:true;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">Docker tensorflow (Recomendada por Sipeed):</span></span></div></li></ol></ol><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Aquí recomiendan la versión de tensorflow 1.13.1, para usarlo se necesita actualizar los drivers de la gráfica, aquí tenéis la guía de instalación de tensorflow:</span></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><a href="https://www.tensorflow.org/install/docker%20%5Ch" style="text-indent: 0mm; font-size: 12pt; color: rgb(5, 99, 193); font-family: &quot;Times New Roman&quot;; line-height: 108%; text-decoration: underline;">https://www.tensorflow.org/install/docker</a></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; line-height: 108%;"> </span></div><ol start="2" style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><ol start="2" style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 47pt; margin-right: 0pt; padding-left: 17pt; text-indent: 0pt; font-size: 12pt;"><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt;-en-paragraph:true;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">Instalación mediante pip:</span></span></div></li></ol></ol><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Se necesita instalar tensorflow-gpu == 1.13.1 si quieres usar la misma versión que recomiendan en sipeed con la versión de gpu, si quieres usar la versión de cpu hay que eliminar la parte de gpu: tensorflow==1.13.1.</span></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Además, necesitaremos instalar el software de NVIDIA donde se puede encontrar la información aquí:</span> <span style="font-size: 12pt;"><a href="https://www.tensorflow.org/install/gpu/" style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">https://www.tensorflow.org/install/gpu/</a></span></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Para saber que versión instalar se puede mirar en esta gráfica:</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><img src="Documentación instalación entorno(Keras),entrenamiento y ejecución_files/Image.png" type="image/png" data-filename="Image.png" width="685"/></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Sacada de</span> <a href="https://www.tensorflow.org/install/source#linux">https://www.tensorflow.org/install/source#linux</a></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; line-height: 108%;"> </span></div><ol start="3" style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><ol start="3" style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;"><li style="margin-left: 47pt; margin-right: 0pt; padding-left: 17pt; text-indent: 0pt; font-size: 12pt;"><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt;-en-paragraph:true;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">Instalación mediante conda (Anaconda, la que he usado yo):</span></span></div></li></ol></ol><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Parecido a la instalación mediante pip pero con más facilidades, para instalar tensorflow gpu basta con poner el siguiente comando:</span></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: center;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">conda install tensorflow-gpu==1.13.1</span></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: center;"><br/></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">con esto instalará todos los requisitos de NVIDIA que necesita esta versión de tensorflow, como en pip se necesitará que tengas actualizados los drives de tu gráfica, pero no tendrás que instalar uno a uno todos los componentes.</span></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Además, en el caso de que se use la versión de CPU (intel) anaconda tiene un rendimiento bastante significativo (alrededor de 8 veces más rápido) en comparación </span></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">con pip como se muestra en la siguiente figura:</span></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><img src="Documentación instalación entorno(Keras),entrenamiento y ejecución_files/Image [1].png" type="image/png" data-filename="Image.png" width="554"/></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Este ejemplo se realizó con un</span> <span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-style: italic; line-height: 108%; text-decoration: underline;">Intel® Xeon® Gold 6130.</span></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-style: italic; line-height: 108%; text-decoration: underline;">La información se puede encontrar aquí:</span></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><span style="font-size: 12pt;"><a href="https://www.anaconda.com/tensorflow-in-anaconda/" style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">https://www.anaconda.com/tensorflow-in-anaconda/</a></span></div><div style="margin: 0mm 0mm 2.81mm 25mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">2. Descargar el modelo pre entrenado de mobilenetv1</span></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><a href="https://arxiv.org/pdf/1704.04861.pdf" style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">https://arxiv.org/pdf/1704.04861.pdf</a></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><a href="https://ai.googleblog.com/2017/06/mobilenets-open-source-models-for.html" style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">https://ai.googleblog.com/2017/06/mobilenets-open-source-models-for.html</a></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;"> </span></span></div><div style="text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">Mobilenetv1</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">son clases de modelos eficientes llamados MobileNets para aplicaciones de móviles y aplicaciones de visión empotradas. Se basa en una arquitectura optimizada que utiliza convoluciones separables en profundidad para construir redes profundas de peso ligero.</span></div><div style="text-align: justify;"><font face="Times New Roman" style="font-size: 12pt;"><br/></font></div><div style="text-align: justify;"></div><div style="text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">Introducen 2 hiperparámetros:</span></div><div style="text-align: justify;"><font face="Times New Roman" style="font-size: 12pt;"><br/></font></div><div style="text-align: justify;"></div><div style="text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">Multiplicador de anchura</span><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">: Se usa para adelgazar una red de manera uniforme en cada capa. Dada una capa y un multiplicador de anchura α el número de canales de entrada M sería αM y el número de canales de salida N sería αN.</span></div><div style="text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">Esto tiene el efecto de reducir el coste computacional y el número de parámetros cuadráticamente alrededor de α</span><span style="vertical-align: super; font-size: 12pt; font-family: &quot;Times New Roman&quot;;">2</span><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">. Se puede aplicar a cualquier estructura de modelo para definir un nuevo modelo más pequeño.</span></div><div style="text-align: justify;"></div><div style="text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">Multiplicador de resolución (ρ)</span><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">: Se aplica en la imagen de entrada y la interna representación de cada capa es reducida por dicho multiplicador.</span></div><div style="text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">Aplicamos este hiperparámetro implícitamente cuando ajustamos la resolución de entrada, es decir al poner como resolución 224,192,160 o 128.</span></div><div style="text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">Esto hace reducir el coste computacional alrededor de ρ</span><span style="vertical-align: super; font-size: 12pt; font-family: &quot;Times New Roman&quot;;">2</span><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">.</span></div><div style="text-align: justify;"></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-underline: none;-en-paragraph:true;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">La arquitectura de mobilenet se puede observar en la siguiente tabla:</span></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold;"><img src="Documentación instalación entorno(Keras),entrenamiento y ejecución_files/Image [2].png" type="image/png" data-filename="Image.png" width="414"/></span></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="font-size: 12pt;"><a href="https://github.com/fchollet/deep-learning-models/releases/tag/v0.6/" style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">https://github.com/fchollet/deep-learning-models/releases/tag/v0.6/</a></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Se recomienda usar</span> <span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">mobilenet_7_5_224_tf_no_top.h5</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Lo guardaremos en</span> <span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">~</span> <span style="text-indent: 0mm; font-size: 10pt; color: rgb(1, 1, 1); font-family: &quot;Courier New&quot;; line-height: 108%;">/.keras/models/</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Significa que tiene un valor alpha = 0.75 llamado multiplicador de anchura, el tamaño de la imagen de entrada es de 224x224 y sin capa del top(sin dropout ni última capa conectada con activación softmax).</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Se recomienda por la siguiente tabla:</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><img src="Documentación instalación entorno(Keras),entrenamiento y ejecución_files/Image [3].png" type="image/png" data-filename="Image.png" width="761"/></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">La diferencia entre un alpha 1.00x  a 0.75x es de más o menos un 2% de pérdida de precisión, mientras que el número de parámetros se reduce de 4.24M a 2.59M, que usando una cuantización de 8 bits se resume en 4.25MB vs 2.59MB, una diferencia considerable.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Usando Micropython no podríamos usar el de 4.35MB, pero sí el de 2.59MB, en cambio sí se usa Standalone o FreeRTOS se podría usar ambos sin problema.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Yo he probado a entrenar ambos modelos, que los comentaré más adelante.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">3. Descargar el conjunto de datos imagenet ILSVRC2012_IMG_TRAIN</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Son 150GB así que deja espacio suficiente en disco.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Este conjunto de datos contiene 1000 clases, al descomprimirlo tendrás 1000 .tar por lo que será necesario usar un script para agilizar la operación:</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><img src="Documentación instalación entorno(Keras),entrenamiento y ejecución_files/Image [4].png" type="image/png" data-filename="Image.png" width="690"/></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">4. Ajustar el archivo original mobilenet.py</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">El chip k210 usa un relleno de ceros en todas las direcciones (arriba, abajo, derecha, izquierda) mientras que el relleno de Keras es solo de derecha y abajo, por lo que vamos a necesitar cambiar dos líneas al fichero original.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Se encuentra en ~</span> <span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Courier New&quot;; line-height: 108%;">/python3.5/site-packages/keras_applications/mobilenet.py</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">En la función original tenemos:</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">x = layers.ZeroPadding2D(padding = ( ( 0, 1 ), ( 0, 1 ) ), name = ‘conv_pad_%d’ % block_id ) (inputs)</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;"> Y nosotros queremos:</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">x = layers.ZeroPadding2D(padding = ( ( 1, 1 ), ( 1, 1 ) ), name = ‘conv_pad_%d’ % block_id ) (inputs)</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Aparece 2 veces, en la línea 354 y en la 423.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">5. Terminar script de entrenamiento</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Como hemos escogido un modelo sin el top (sin softmax ni dropout) tenemos que añadirlo, sipeed nos proporciona un script hecho, aunque realmente lo que hace es:</span></div><ol style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt; list-style-type: lower-alpha;"><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-size: 12pt;"><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt;-en-paragraph:true;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">Añadir el dropout y una capa final con activación softmax.</span></span></div></li></ol><div style="margin: 0mm 0mm 2.81mm 13mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm 13mm; text-indent: 0mm; text-align: justify;"><img src="Documentación instalación entorno(Keras),entrenamiento y ejecución_files/Image [5].png" type="image/png" data-filename="Image.png" width="990"/></div><div style="margin: 0mm 0mm 2.81mm 13mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Si queremos usar el modelo con 1.00x de channel count tenemos que cambiar Alpha a ese mismo valor.</span></div><div style="margin: 0mm 0mm 2.81mm 13mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; line-height: 108%;"> </span></div><ol start="2" style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt; list-style-type: lower-alpha;"><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-size: 12pt;"><div style="margin-top: 0pt; margin-bottom: 8pt;"><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt;-en-paragraph:true;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">Arreglar los pesos de las capas anteriores.</span></span></div></div></li></ol><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm 13mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm 13mm; text-indent: 0mm; text-align: justify;"><img src="Documentación instalación entorno(Keras),entrenamiento y ejecución_files/Image [6].png" type="image/png" data-filename="Image.png" width="326"/></div><ol start="3" style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt; list-style-type: lower-alpha;"><li style="margin-left: 33pt; margin-right: 0pt; padding-left: 0pt; text-indent: 0pt; font-size: 12pt;"><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt;-en-paragraph:true;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">Guardar el modelo</span></span></div></li></ol><div style="margin: 0mm 0mm 2.81mm 13mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm 13mm; text-indent: 0mm; text-align: justify;"><img src="Documentación instalación entorno(Keras),entrenamiento y ejecución_files/Image [7].png" type="image/png" data-filename="Image.png" width="996"/></div><div style="margin: 0mm 0mm 2.81mm 13mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">En mi caso, tengo una Nvidia 1060 6GB por lo que la línea donde se paraleliza el modelo no la uso, así que si tienes múltiples gráficas te servirá para acelerar el proceso, en mi caso no por lo que basta con eliminar la parte de: paralleled_ quedando, por ejemplo:</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">            model.summary()</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">El script se puede encontrar en su github:</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><a href="https://github.com/sipeed/Maix-Keras-workspace/tree/master/mbnet%20%5Ch" style="text-indent: 0mm; font-size: 12pt; color: rgb(5, 99, 193); font-family: &quot;Times New Roman&quot;; line-height: 108%; text-decoration: underline;">https://github.com/sipeed/Maix-Keras-workspace/tree/master/mbnet</a></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">archivo mbnet_keras.py</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Algunos parámetros que he modificado en el entrenamiento:</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">batch_size: Número de ejemplos de entrenamiento utilizados en una iteración.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">epotch: Es un paso completo a través de los datos de entrenamiento.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">step_size_train: Número de pasos dentro de un epotch.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Ejecutamos mbnet_keras.py y empezará a entrenar.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">EJEMPLOS</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">He realizado 3 entrenamientos,</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%; font-weight: bold;">1º</span> Sin modificar ningún parámetro y usando el modelo con 0.75x , donde he conseguido una precisión de 0.60 tardando algo más de 4 horas.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Resultado esperado ya que era lo previsto del ejemplo por el cual partíamos como referencia.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">2º</span> <span style="font-size: 12pt; text-indent: 0mm; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Usando el</span><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;"> </span><span style="font-size: 12pt; text-indent: 0mm; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">modelo es el de 1.00x  donde conseguí una precisión de 0.62 tardando 3 horas 24 min.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Un resultado esperado ya que en la tabla podíamos apreciar que aumentábamos mucho el número de parámetros, pero tendríamos una diferencia de un 2% aproximadamente y es lo que hemos obtenido.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><img src="Documentación instalación entorno(Keras),entrenamiento y ejecución_files/Image [8].png" type="image/png" data-filename="Image.png" width="694"/></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">En este modelo, he necesitado cambiar el batch size de 512 a 256, ya que por la cantidad de memoria de mi gpu no podía distribuir tantos datos, significando un error de OOM (Out Of Memory) y no podía entrenarlo con mi gráfica, bajando este parámetro funcionó sin problemas.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">3º</span></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Usando el modelo de 0.75x cambiando el batch size y el número de epotch. En este caso decidí aumentar por 4 este número, siendo así epotch = 80 y un batch size de 256 intentando conseguir una mejora, pero solo conseguí un 0.63 de precisión (vs el 0.60 del primer ejemplo) tardando alrededor de 8 horas en entrenarlo.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Intentando ver si aumentando el parámetro epotch observamos una mejora de precisión:</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><img src="Documentación instalación entorno(Keras),entrenamiento y ejecución_files/Image [9].png" type="image/png" data-filename="Image.png" width="741"/></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">6. Convertir a kmodel</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Las herramientas las proporciona sipeed, aquí podéis encontralas:</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><a href="https://github.com/sipeed/Maix_Toolbox/">https://github.com/sipeed/Maix_Toolbox/</a></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="text-underline: none;-en-paragraph:true;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">Maix Toolbox es una colección de herramientas para modelos (scripts).</span></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-underline: none;-en-paragraph:true;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">Se puede usar para convertir el modelo de un formato a otro, lo podemos ver en la siguiente tabla:</span></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;"><img src="Documentación instalación entorno(Keras),entrenamiento y ejecución_files/Image [10].png" type="image/png" data-filename="Image.png"/></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="font-size: 12pt;"><br/></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Primero obtenemos las herramientas con el script get_nncase.sh</span></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="text-underline: none;-en-paragraph:true;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">NNcase es un compilador de modelos y herramienta de inferencia.</span></span></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="text-underline: none;-en-paragraph:true;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">Tiene 2 comandos ‘compile e ‘infer’</span></span></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="text-underline: none;-en-paragraph:true;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">‘compile’ compila el modelo entrenado (.tflite, .caffemodel) a kmodel.</span></span></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="text-underline: none;-en-paragraph:true;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">Kmodel tiene 2 versiones: kmodelV3 y kmodelV4.</span></span></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;-en-paragraph:true;">KmodelV3 es la generada por la versión anterior de nncase a 0.2 y es la versión más optimizada, ya que la versión kmodelV4 a pesar de soportar más operaciones, más modelos cuesta más memoria (alrededor de 360KBde ram ), está en desarrollo luego hay operaciones que no están tan bien como el la V3 y tiene una latencia mayor (37ms vs</span><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;-en-paragraph:true;"> </span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;-en-paragraph:true;">111ms)</span></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="text-underline: none;-en-paragraph:true;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">La diferencia de fps entre las dos versiones es notoria (V3: ~24.05 fps V4: 8.45 fps).</span></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-underline: none;-en-paragraph:true;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">Tiene los siguientes parámetros:</span></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="font-size: 11pt; font-family: &quot;Times New Roman&quot;;"><img src="Documentación instalación entorno(Keras),entrenamiento y ejecución_files/Image [11].png" type="image/png" data-filename="Image.png"/></span></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="text-underline: none;-en-paragraph:true;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">&lt;input file&gt;</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">dirección del modelo de entrada.</span></span></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">&lt;output file&gt;</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">dirección del modelo de salida.</span></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">-i, --input-format</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">opción usada para espeficicar el formato del modelo de entrada. Nncase soporta modelos tflite y caffe.</span></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="text-underline: none;-en-paragraph:true;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">-o, --output-format</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">opción usada para especificar el formato de salida del modelo, solo hay una opción: kmodel.</span></span></div><div style="text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">-t, --target</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">La opción se utiliza para configurar el dispositivo de destino deseado para ejecutar el modelo. CPU es el objetivo más general que casi todas las plataformas deberían admitir. k210 es la plataforma Kendryte K210 SoC. Si se configura esta opción en k210, este modelo solo puede ejecutarse en K210 o ser emulado en el PC.</span></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="text-underline: none;-en-paragraph:true;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">--inference-type</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">configurar a float si se quiere precisión a coste de más memoria y pérdida de aceleración en el K210 KPU.Configurar a unit8 si se quiere mayor aceleración del KPU y mayor velocidad, se necesita dar un conjunto de datos para la cuantización de calibración para cuantizar los modelos más tarde.</span></span></div><div style="text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">-</span><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">-dataset</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">es para proporcionar tu conjunto de datos de calibración de cuantización para cuantificar tus modelos. Debe poner cientos o miles de datos en el conjunto de entrenamiento en este directorio. Solo se necesita esta opción cuando se establece --inference-type en uint8.</span></div><div style="text-align: justify;"><font face="Times New Roman" style="font-size: 12pt;"><br/></font></div><div style="text-align: justify;"></div><div style="text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">-</span><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">-dataset-format</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">es para establecer el formato del conjunto de datos de calibración. El valor predeterminado es ‘image’, nncase usará opencv para leer sus imágenes y escalar automáticamente al tamaño de entrada deseado de tu modelo. Si la entrada tiene 3 canales, ncc convertirá imágenes a float tensors RGB [0,1] en diseño NCHW. Si la entrada tiene solo 1 canal, ncc escalará en gris sus imágenes. Establezca en ‘raw’ si el conjunto de datos no es un conjunto de datos de imagen, por ejemplo, audio o matrices. En este escenario, debes convertir tu conjunto de datos a archivos binarios sin formato que contengan float tensors. Solo necesita esta opción cuando se establece --inference-type en uint8.</span></div><div style="text-align: justify;"><font face="Times New Roman" style="font-size: 12pt;"><br/></font></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">--input-std and --input-mean</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">es para establecer el método de preproceso en tu conjunto de datos de calibración. Como se dijo anteriormente, ncc primero convertirá las imágenes en float tensors RGB [0,1] en el diseño NCHW, luego ncc normalizará sus imágenes usando la fórmula y = (x - mean) / std. Hay una tabla de argumentos de referencia:</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;"><img src="Documentación instalación entorno(Keras),entrenamiento y ejecución_files/Image [12].png" type="image/png" data-filename="Image.png"/></span></div><div style="text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--calibrate-method</span> El método consiste en establecer el método de calibración deseado, que se utiliza para seleccionar los rangos de activación óptimos. El valor predeterminado es no_clip, ya que ncc usará el rango completo de activaciones. Si se desea un mejor resultado de cuantización, puede usar l2 pero tomará más tiempo encontrar los rangos óptimos.</span></div><div style="text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--input-type</span> es para establecer el tipo de datos de entrada deseado cuando se hace la inferencia. El valor predeterminado es igual al tipo de inferencia. Si --input-type es uint8, por ejemplo, debe proporcionar RGB888 uint8 tensors cuando se haga la inferencia. Si --input-type es float, debe proporcionar float tensors RGB en su lugar.</span></div><div style="text-align: justify;"></div><div style="text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--max-allocator-solve-secs</span> es para limitar el tiempo máximo de resolución cuando se realiza la mejor búsqueda de asignación. Si se excede el tiempo de búsqueda, ncc recurrirá para usar el primer método de ajuste. El valor predeterminado es 60 segundos, establecido en 0 para deshabilitar la búsqueda.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--dump-ir</span> es una opción de debug. Cuando está activado, ncc producirá algunos archivos de gráficos .dot en el directorio de trabajo. Puede usar Graphviz o Graphviz Online para ver estos archivos.</span></div><div style="text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">El comando</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">infer</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">puede ejecutar el kmodel, y se usa como propósito de depuración. ncc guardará los tensors de salida del modelo en archivos .bin en NCHW.</span></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;-en-paragraph:true;">&quot;NCHW&quot; significa data cuyo diseño es</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; line-height: 107%;-en-paragraph:true;">(batch_size, channel, height, width)</span></div><div style="text-align: justify; margin-top: 1em; margin-bottom: 1em;"><font style="font-size: 12pt;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;-en-paragraph:true;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">&lt;input file&gt;</span> es tu dirección donde se encuentra tu kmodel.</span></font></div><div style="text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">&lt;output path&gt;</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">es el directorio donde se producirá la salida.</span></div><div style="text-align: justify;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">--dataset</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">es el directorio del conjunto de prueba.</span></div><div style="text-align: justify;"><span style="font-size: 12pt; text-indent: 0mm; font-family: &quot;Times New Roman&quot;;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; font-weight: bold;">--dataset-format, --input-std and --input-mean tienen el</span> mismo significado que en el comando compile.</span></div><div style="text-align: justify;"><span style="font-size: 12pt; text-indent: 0mm;"><br/></span></div><div style="text-align: justify;"><span style="font-size: 12pt; text-indent: 0mm;"><br/></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Ojo que hay un error en el script hay que cambiar a las siguientes líneas:</span></div><div style="text-align: justify;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;;">tar -Jxf ncc-linux-x86_64.tar.xz</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;;">rm ncc-linux-x86_64.tar.xz</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;;">También puedes descargarlo manualmente y poner los contenidos en la carpeta creada ncc.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;;">enlace aquí: </span><span style="font-size: 12pt;"><a href="https://github.com/kendryte/nncase/releases" style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">https://github.com/kendryte/nncase/releases</a></span><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;;">  la versión utilizada es </span> <span style="font-size: 12pt;"><a href="https://github.com/kendryte/nncase/releases/tag/v0.1.0-rc5" style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">NNCase Converter v0.1.0 RC5</a></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Una vez tenemos todo preparado ya podemos convertir nuestro modelo a .pb con el siguiente comando:</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;;">./keras_to_tensorflow.py --input_model workspace/mbnet75.h5  --output_model workspace/mbnet75.pb</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 12pt;"><br/></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">(Podemos obtener un grafo de nuestro modelo si se desea con el siguiente script) </span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;;">./gen_pb_graph.py workspace/mbnet75.pb</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 12pt;"><br/></span></div><div style="min-height: 11pt; text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; line-height: normal;">pb significa ‘protobuf’, este contiene tanto la definición de</span><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; line-height: normal;"> </span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;; line-height: normal;">grafo como los pesos del modelo.</span></div><div style="min-height: 11pt; text-align: left;"></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Para convertir nuestro modelo.pb a modelo.tflite existe un script que te guía a obtener el comando</span> <span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">pb2tflite.sh</span><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">, al final el comando quedaría de la siguiente forma:</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Podemos usar toco o tflite_convert</span></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;;">toco --graph_def_file=workspace/mbnet75.pb --input_format=TENSORFLOW_GRAPHDEF --output_format=TFLITE --output_file=workspace/mbnet75.tflite --inference_type=FLOAT --input_type=FLOAT --input_arrays=input_1 --output_arrays=dense_1/Softmax --input_shapes=1,224,224,3</span></div><div style="margin-top: 1em; margin-bottom: 1em; text-align: left;"><span style="font-size: 24pt; font-weight: bold;-en-paragraph:true;">TensorFlow Lite Converter</span></div><div style="min-height: 11pt; text-align: left;"><span style="mso-fareast-font-family: &quot;Times New Roman&quot;;mso-font-kerning: 18.0pt;mso-fareast-language: ES;text-underline: none;-en-paragraph:true;"><span style="font-size: 12pt;">Una vez que tenemos un modelo de TensorFlow capacitado, el convertidor de TensorFlow Lite aceptará ese modelo y generará un archivo FlatBuffer de TensorFlow Lite. El convertidor actualmente admite SavedModels, gráficos congelados (modelos generados a través de freeze_graph.py) y archivos de modelo tf.Keras. El archivo FlatBuffer de TensorFlow Lite se puede enviar a los dispositivos del cliente, generalmente dispositivos móviles, donde el intérprete de TensorFlow Lite los maneja en el dispositivo. Este flujo se representa en el siguiente diagrama.</span></span></div><div style="min-height: 11pt; text-align: left;"><span style="font-size: 12pt;"><img src="Documentación instalación entorno(Keras),entrenamiento y ejecución_files/Image [13].png" type="image/png" data-filename="Image.png"/></span></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">Comandos para usar toco o tflite_convert:</span></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--output_file</span>. Type: string.</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">Especifica la ruta completa del archivo de salida.</span></div><div style="text-align: left;"><span style="font-size: 12pt;"><br/></span></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--graph_def_file</span>. Type: string.</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">Especifica la ruta completa del archivo GraphDef de entrada congelado usando freeze_graph.py.</span></div><div style="text-align: left;"><span style="font-size: 12pt;"><br/></span></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--saved_model_dir</span>. Type: string.</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">Especifica la ruta completa al directorio que contiene el modelo guardado.</span></div><div style="text-align: left;"><span style="font-size: 12pt;"><br/></span></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--keras_model_file</span>. Type: string.</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">Especifica la ruta completa del archivo HDF5 que contiene el modelo tf.keras.</span></div><div style="text-align: left;"><span style="font-size: 12pt;"><br/></span></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--output_format</span>. Type: string. Default: TFLITE.</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">Especifica el formato del archivo de salida. Valores permitidos:</span></div><div style="text-align: left;"><span style="font-size: 12pt;"><br/></span></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">TFLITE: TensorFlow Lite FlatBuffer format.</span></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">GRAPHVIZ_DOT:</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">Formato GraphViz .dot que contiene una visualización del gráfico después de las transformaciones del gráfico.</span></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">Tener en cuenta que pasar GRAPHVIZ_DOT a --output_format conduce a la pérdida de transformaciones específicas de TFLite. Por lo tanto, la visualización resultante puede no reflejar el conjunto final de transformaciones gráficas. Para obtener una visualización final con todas las transformaciones de gráficos, usar --dump_graphviz_dir en su lugar.</span></div><div style="text-align: left;"><span style="font-size: 12pt;"><br/></span></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--input_arrays</span>. Type:</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">lista de cadenas separadas por comas. Especifica la lista de nombres de tensores de activación de entrada.</span></div><div style="text-align: left;"><span style="font-size: 12pt;"><br/></span></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--output_arrays</span>. Type:</span> <span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">lista de cadenas separadas por comas. Especifica la lista de nombres de tensores de activación de salida.</span></div><div style="text-align: left;"><span style="font-size: 12pt;"><br/></span></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">Los siguientes indicadores definen las propiedades de los tensores de entrada. Cada elemento en el indicador --input_arrays debe corresponder a cada elemento en los siguientes indicadores según el índice.</span></div><div style="text-align: left;"><span style="font-size: 12pt;"><br/></span></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--input_shapes</span>. Tipo: lista separada por dos puntos de listas enteras separadas por comas. Cada lista de enteros separados por comas da la forma de una de las matrices de entrada especificadas en la convención TensorFlow.</span></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">Ejemplo: --input_shapes = 1,60,80,3 para un modelo de visión típico significa un batch size de 1, una altura de imagen de entrada de 60, un ancho de imagen de entrada de 80 y una profundidad de imagen de entrada de 3 (que representan canales RGB )</span></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">Ejemplo: --input_arrays = foo, bar --input_shapes = 2,3: 4,5,6 significa que &quot;foo&quot; tiene una forma de [2, 3] y &quot;bar&quot; tiene una forma de [4, 5, 6].</span></div><div style="text-align: left;"><span style="font-size: 12pt;"><br/></span></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--std_dev_values, --mean_values</span>. Tipo: lista de floats separados por comas. Estos especifican los parámetros de (de-)cuantización de la matriz de entrada, cuando se cuantifica. Esto solo es necesario si inference_input_type es QUANTIZED_UINT8.</span></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">El significado de mean_values y std_dev_values es el siguiente: cada valor cuantificado en la matriz de entrada cuantificada se interpretará como un número real matemático (es decir, como un valor de activación de entrada) de acuerdo con la siguiente fórmula:</span></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">real_value = (quantized_input_value - mean_value) / std_dev_value.</span></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">Al realizar la inferencia flotante (--inference_type = FLOAT) en una entrada cuantificada, la entrada cuantificada se descartaría inmediatamente por el código de inferencia de acuerdo con la fórmula anterior, antes de proceder con la inferencia flotante.</span></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">Cuando se realiza una inferencia cuantificada (--inference_type = QUANTIZED_UINT8), el código de inferencia no realiza la descuantificación. Sin embargo, los parámetros de cuantificación de todas las matrices, incluidas las de las matrices de entrada especificadas por mean_value y std_dev_value, determinan los multiplicadores de punto fijo utilizados en el código de inferencia cuantificado. mean_value debe ser un número entero cuando se realiza una inferencia cuantificada.</span></div><div style="text-align: left;"><span style="font-size: 12pt;"><br/></span></div><div style="text-align: left;"></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--inference_type</span>. Tipo: string. Predeterminado: float. Tipo de datos de todas las matrices de números reales en el archivo de salida, excepto las matrices de entrada (definidas por --inference_input_type). Debe ser {FLOAT, QUANTIZED_UINT8}.</span></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">Este indicador solo afecta a las matrices de números reales, incluidas las matrices flotantes y cuantizadas. Esto excluye todos los demás tipos de datos, incluidas las matrices enteras simples y las matrices de cadenas. Específicamente:</span></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">Si FLOAT, las matrices de números reales serán de tipo float en el archivo de salida. Si se cuantificaron en el archivo de entrada, se descuantifican.</span></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">Si QUANTIZED_UINT8, las matrices de números reales se cuantificarán como uint8 en el archivo de salida. Si fueron flotantes en el archivo de entrada, entonces se cuantizaron.</span></div><div style="text-align: left;"><span style="font-size: 12pt;"><br/></span></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--inference_input_type</span>. Tipo: string. Tipo de datos de una matriz de entrada de número real en el archivo de salida. Por defecto, --inference_type se usa como tipo de todas las matrices de entrada. Flag está destinado principalmente a generar un gráfico de punto flotante con una matriz de entrada cuantificada. Se agrega un operador descuantificado inmediatamente después de la matriz de entrada. Debe ser {FLOAT, QUANTIZED_UINT8}.</span></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;">La bandera se usa típicamente para modelos de visión que toman un mapa de bits como entrada, pero requieren inferencia de punto flotante. Para tales modelos de imagen, la entrada uint8 se cuantifica y los parámetros de cuantificación utilizados para tales matrices de entrada son sus parámetros mean_value y std_dev_value.</span></div><div style="text-align: left;"><span style="font-size: 12pt;"><br/></span></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--default_ranges_min, --default_ranges_max</span>. Tipo: punto flotante. Valor predeterminado para los valores de rango (min, max) utilizados para todas las matrices sin un rango especificado. Permite al usuario proceder con la cuantificación de archivos de entrada no cuantificados o cuantificados incorrectamente. Estas banderas producen modelos con baja precisión. Están destinados a una fácil experimentación con la cuantización a través de la &quot;cuantificación ficticia&quot;.</span></div><div style="text-align: left;"><span style="font-size: 12pt;"><br/></span></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--drop_control_dependency</span>. Tipo: booleano. Valor predeterminado: verdadero. Indica si se deben eliminar las dependencias de control de forma silenciosa. Esto se debe a que TensorFlow Lite no admite dependencias de control.</span></div><div style="text-align: left;"><span style="font-size: 12pt;"><br/></span></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--reorder_across_fake_quant</span>. Tipo: booleano. Valor predeterminado: falso. Indica si se debe reordenar los nodos FakeQuant en ubicaciones inesperadas. Se utiliza cuando la ubicación de los nodos FakeQuant impide las transformaciones gráficas necesarias para convertir el gráfico. Resultados en un gráfico que difiere del gráfico de entrenamiento cuantificado, lo que puede causar un comportamiento aritmético diferente.</span></div><div style="text-align: left;"><span style="font-size: 12pt;"><br/></span></div><div style="text-align: left;"></div><div style="text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--allow_custom_ops</span>. Tipo: string. Valor predeterminado: falso. Indica si se permiten operaciones personalizadas. Cuando es falso, cualquier operación desconocida es un error. Cuando es verdadero, se crean operaciones personalizadas para cualquier operación que sea desconocida. El desarrollador deberá proporcionarlos al tiempo de ejecución de TensorFlow Lite con un solucionador personalizado.</span></div><div style="text-align: left;"><span style="font-size: 12pt;"><br/></span></div><div style="text-align: left;"></div><div style="min-height: 11pt; text-align: left;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif;"><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;, serif; font-weight: bold;">--post_training_quantize</span>. Tipo: booleano. Valor predeterminado: falso. Booleano que indica si cuantificar los pesos del modelo flotante convertido. El tamaño del modelo se reducirá y habrá mejoras de latencia (a costa de la precisión).</span></div><div style="min-height: 11pt; text-align: left;"><span style="font-size: 12pt;"><br/></span></div><div style="min-height: 13pt; text-align: left;"><span style="min-height: 13pt; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;;">Para convertir a kmodel recuerda que en la carpeta images:\ de la herramienta necesitamos meter algunas imágenes, en este caso he usado las mismas del conjunto de datos del entrenamiento  asegurándome que tiene una resolución 224x224(las puedes cambiar de resolución si no tuvieran el tamaño deseado).</span></div><div style="min-height: 13pt; text-align: left;"><br/></div><div style="min-height: 11pt; text-align: left;"><span style="min-height: 11pt; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;;">./tflite2kmodel.sh workspace/mbnet75.tflite</span></div><div style="min-height: 11pt; text-align: left;"><img src="Documentación instalación entorno(Keras),entrenamiento y ejecución_files/Image [14].png" type="image/png" data-filename="Image.png" width="700"/></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Con esto ya tendríamos nuestro modelo en formato kmodel y listo para probarlo.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">7. Introducir el kmodel usando micropython y MaixpyIde, o c con Standalone o FreeRTOS:</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Herramienta para introducir todos los archivos necesarios:</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><a href="https://github.com/sipeed/kflash_gui/releases/">https://github.com/sipeed/kflash_gui/releases/</a></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">MaixpyIde:</span></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Descargar el ide:</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><a href="http://dl.sipeed.com/MAIX/MaixPy/ide/_/v0.2.4/">http://dl.sipeed.com/MAIX/MaixPy/ide/_/v0.2.4/</a></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">Añadir firmware de maixpy he usado esta versión:</span></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;">Nota: Para que funcione correctamente es necesario tener un firmware igual o superior a al versión 0.4</div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><a href="http://dl.sipeed.com/MAIX/MaixPy/release/master/maixpy_v0.5.0_19_g64e411a/">http://dl.sipeed.com/MAIX/MaixPy/release/master/maixpy_v0.5.0_19_g64e411a/</a></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">Añadir el modelo en la dirección 0x00200000</span></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Introducir en la memoria flash del sistema el archivo labels.txt que contiene los “synsets” </span><span style="font-size: 12pt; text-indent: 0mm; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;;">correspondientes al conjunto de datos (lista de palabras o frases que pueden sustituirse entre ellas en algún contexto).</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Aquí se puede descargar el archivo:</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><a href="https://en.bbs.sipeed.com/uploads/default/original/1X/d41ad9dfbe01f228abe726986fbf1baf4e288f2e.zip">https://en.bbs.sipeed.com/uploads/default/original/1X/d41ad9dfbe01f228abe726986fbf1baf4e288f2e.zip</a></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Para hacerlo podemos usar distintas opciones, yo he usado uPyloader, esta información se puede encontrar en:</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><a href="https://maixpy.sipeed.com/en/get_started/edit_file.html">https://maixpy.sipeed.com/en/get_started/edit_file.html</a></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">Una vez que tengamos todo solo necesitamos ejecutar la demo en micropython.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt;"><span style="font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; font-weight: bold; line-height: 108%;">Standalone o FreeRTOS:</span></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">En mi caso he usado Standalone.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="text-indent: 0mm; font-size: 12pt; color: rgb(1, 1, 1); font-family: &quot;Times New Roman&quot;; line-height: 108%;">He usado platformIO como ide para compilar el proyecto, obteniendo el firmware que introduciremos en la dirección 0x00000000 y el modelo en la dirección 0x00200000.</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="font-size: 12pt;"><a href="http://blog.sipeed.com/p/622.html" style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">http://blog.sipeed.com/p/622.html</a></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="font-size: 12pt;"><a href="https://docs.platformio.org/en/latest/boards/kendryte210/sipeed-maix-go.html" style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">https://docs.platformio.org/en/latest/boards/kendryte210/sipeed-maix-go.html</a></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="font-size: 12pt;"><a href="https://docs.platformio.org/en/latest/platforms/kendryte210.html" style="font-size: 12pt; font-family: &quot;Times New Roman&quot;;">https://docs.platformio.org/en/latest/platforms/kendryte210.html</a></span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><br/></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm; text-align: justify;"><span style="font-size: 18pt; font-weight: bold; line-height: 107%;-en-paragraph:true;">Gráficas y limitaciones</span></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm;"><img src="Documentación instalación entorno(Keras),entrenamiento y ejecución_files/Image [15].png" type="image/png" data-filename="Image.png"/></div><div style="margin: 0mm 0mm 2.81mm; text-indent: 0mm;"><br/></div><div><br/></div></div><div><img src="Documentación instalación entorno(Keras),entrenamiento y ejecución_files/Image [16].png" type="image/png" data-filename="Image.png"/></div><div><img src="Documentación instalación entorno(Keras),entrenamiento y ejecución_files/Image [17].png" type="image/png" data-filename="Image.png"/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="text-underline: none;-en-paragraph:true;"><span style="font-size: 12pt;">Limitaciones:</span></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="text-underline: none;-en-paragraph:true;"><span style="font-size: 12pt;">K210 dispone de 6 MB SRAM para propósito general (según la documentación usables entre 5.5 y 5.9) y 2MB on-chip AI SRAM solamente para el KPU.</span></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="text-underline: none;-en-paragraph:true;"><span style="font-size: 12pt;">Por lo que podemos decir que alrededor de 5 MB disponibles en un entorno C mientras que al usar el entorno de MicroPython tendremos entre 3.5MB y 4MB.</span></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="text-underline: none;-en-paragraph:true;"><span style="font-size: 12pt;">La memoria flash tiene 16MB estando el firmware desde la dirección 0x00000000.</span></span></div><div><br/></div></span>
</div></body></html> 